define("jzform/jzformElement",["require","underscore","jquery","backbone"],function(e,t,n,r){var i=function(e,t){var r={filters:[],validators:[]};this.form=e,this.params=n.extend(r,t),this.initialize()};return t.extend(i.prototype,r.Events,{input:null,filters:null,validators:null,messages:[],initialize:function(){this._events={},this.listenTo(this.form,"before:close",this.destroy),this.prepareFilters(),this.prepareValidators(),this.getInput()},prepareFilters:function(){var t=this;this.filters=[],n.each(this.params.filters,function(n,r){var i="jzform/filter/"+r.name;e([i],function(e){var n=new e(r.options);t.filters.push(n)})})},prepareValidators:function(){var t=this;this.validators=[],n.each(this.params.validators,function(n,r){var i="jzform/validator/"+r.name;r.options.element=t,e([i],function(e){var n=new e(r.options,r.messages);t.validators.push(n)})})},getInput:function(){if(!this.input){var e='*[name="'+this.params.name+'"]',t=this.form.$el.find(e),n=t.length>0?t:!1;n&&this.setInput(n)}return this.input},setInput:function(e){this.input=e,this.input&&!this.input.data("events-bound")&&this.bindEvents(this.input)},bindEvents:function(e){var t=this;e.data("events-bound",1),e.bind("focus blur change keydown keyup paste",function(e){t.trigger(e.type,e),t.form.trigger(e.type+":"+t.params.name,t)}),this.listenTo(this,"change",this.validate)},filter:function(){if(this.params.type==="file")return;var e=this.getInput();if(e){var t=this.getValue(),n=this.filterValue(t);e.val(n)}return!0},filterValue:function(e){var t=e;return n.each(this.filters,function(e,n){t=n.filter(t)}),t},validate:function(){var e=this.isValid();return this.getTarget().toggleClass("invalid",!e),this.renderMessages(),e},getValue:function(){var e=this.getInput();if(e&&e.filter("[type=radio],[type=checkbox]").length>0){e=e.filter(":checked");if(e.length>1){var t=[];return e.each(function(e,r){t.push(n(r).val())}),t}return e.length===1?e.val():0}return e?e.val():""},setValue:function(e){var t=this.getInput(),r=this.filterValue(e);t.each(function(){var e=n(this);switch(e.attr("type")){case"checkbox":case"radio":if(r instanceof Array){var t=r.map(function(e){return e.toString()}),i=e.val().toString();e.prop("checked",t.indexOf(i)>-1)}else e.prop("checked",r==e.val());break;default:e.val(r)}})},setOptions:function(e){var n=this.getInput(),r=n.get(0).type||n.attr("type");switch(r){case"select":case"select-one":case"select-multi":case"select-multiple":var i="",s=this.normalizeOptions(e);t.each(s,function(e){i+='<option value="'+e.value+'">'+e.label+"</option>"}),n.html(i)}},normalizeOptions:function(e){if(t.isArray(e)===!1&&t.isObject(e)){var n=[];return t.each(e,function(e,t){n.push({label:e,value:t})}),n}return t.isArray(e)&&t.each(e,function(n,r){t.isObject(n)===!1&&(e[r]={label:n,value:r})}),e},renderMessages:function(){if(!this.params.renderMessages)return;var e=this.getTarget(),t=e.find("> .messages");t.length===0&&(t=n('<div class="messages"></div>'),e.append(t)),t.empty(),n.each(this.messages,function(e,n){t.append("<p>"+n+"</p>")})},isValid:function(){this.messages=[];var e=this.getValue(),t=!0,r=this;return n.each(this.validators,function(n,i){t=t&&i.isValid(e,r.form),!t&&i.message&&r.addMessage(i.message)}),t},addMessage:function(e){this.messages.push(e)},getTarget:function(){var e=this.getInput();return e?e.parent("div.element, fieldset"):this.form.$el},destroy:function(){this.trigger("before:destroy"),this.stopListening(),this.trigger("destroy")}}),i}),define("jzform/jzformFieldset",["underscore","jquery","backbone","jzform/jzformElement"],function(e,t,n,r){var i=function(e,n){var r={};this.form=e,this.params=t.extend(r,n),this.initialize()};return e.extend(i.prototype,n.Events,{elements:null,messages:[],initialize:function(){this.prepareElements()},prepareElements:function(){var e=this;this.elements={},t.each(this.getElementParameters(),function(n,s){var o=e.getForm.call(e),u=t.extend(e.params.element,s);switch(u.type){case"fieldset":e.addElement(n,new i(o,u));break;case"element":default:e.addElement(n,new r(o,u))}})},addElement:function(e,t){this.elements[e]=t},getForm:function(){return this.form},getElementParameters:function(){return this.params.elements},getElement:function(e){return this.elements[e]},getInput:function(){return this.getForm().$el.find('*[id="'+this.params.name+'-fieldset"]')},getValue:function(){return this.getValues()},getValues:function(){var e={};return t.each(this.elements,function(t,n){var r=n.params.name,i=n.getValue();if(typeof e[r]=="array")e[r].push(i);else if(r in e){var s=e[r];e[r]=[],s&&e[r].push(s),i&&e[r].push(i)}else e[r]=i}),e},validate:function(){var e=this.isValid();return this.getInput().toggleClass("invalid",!e),e},isValid:function(){var e=!0,n=this.params.stopOnFirstError;return t.each(this.elements,function(t,r){n?e=e&&r.validate.call(r):e=r.validate.call(r)&&e}),e},clearElements:function(e){e=e||".element",this.getInput().find(e).remove()},buildElementsFromCollection:function(e){var t=this,n=this.getTemplate();e.each(function(e,r){var i={index:r,model:e.toJSON()};t.buildElement(n,i)})},buildElementsFromArray:function(e){var n=this,r=this.getTemplate();t.each(e,function(e,t){var i={index:e,model:t};n.buildElement(r,i)})},buildElement:function(t,n){var i=e.template(t,n,{interpolate:/__(.+?)__/g}),s=this.getInput();s.append(i);var o=s.find(".element:last *[name]"),u=this.params.name+"_"+n.index,a={name:this.params.name},f=new r(this.getForm(),a);f.setInput(o),this.addElement(u,f)},getTemplate:function(){var e=this.getInput(),t=e.find("span").attr("data-template");return t.replace(/\[__remove__\]/g,"")},populate:function(e){var n=this;t.each(e,function(e,t){var r=n.getElement(e);r&&r.setValue(t)})},setValue:function(e){this.populate(e)}}),i}),define("jzform/jzform",["underscore","jquery","jzform/jzformFieldset"],function(e,t,n){var r=function(n,r){var i={stopOnFirstError:!1,element:{renderMessages:!0}};this.$el=t(n),this.params=e.extend(i,r),this.initialize()};return e.extend(r.prototype,n.prototype,{initialize:function(){n.prototype.initialize.apply(this,arguments),this.bindEvents()},bindEvents:function(){var e=this;this.$el.bind("submit",function(t){e.submit.call(e,t)}),this.listenTo(this,"submit",function(){this.changeSubmitValue("loading")}),this.listenTo(this,"submit:success",function(){this.changeSubmitValue("success")}),this.listenTo(this,"submit:error",function(){this.changeSubmitValue("error")})},getForm:function(){return this},getElementParameters:function(){return this.params.form.elements},reset:function(){this.$el.get(0).reset()},submit:function(e){this.messages=[];if(this.validate()){this.trigger("before:submit");var t=this.getValues();this.trigger("submit",e,t)}else e.preventDefault()},bindModel:function(e,t){this.model=e,this.bindModelPopulate(e),this.bindModelSubmit(e,t)},bindModelPopulate:function(e){this.listenTo(e,"change",function(){this.populate(e.toJSON())}),this.populate(e.toJSON())},bindModelSubmit:function(n,r){var i=this,s={saveOptions:{},exclude:[],method:"save",isNew:n.isNew()};r=t.extend(s,r);var o=r.saveOptions.save,u=r.saveOptions.error||this.parseErrorMessages,a=r.saveOptions;a.success=function(e){i.trigger("submit:success",e,r),o&&o.call(i,e,r)},a.error=function(e,t){i.trigger("submit:error",e,t),u&&u.call(i,e,t)},this.listenTo(this,"submit",function(t){t.preventDefault();var i=this.getValues(),s=e.omit(i,r.exclude);n[r.method].call(n,s,a)})},parseErrorMessages:function(e,n){var r=this,i=JSON.parse(n.responseText);i.message?(r.addMessage(i.message),r.renderMessages()):i.messages&&(t.each(i.messages,function(){r.addMessage(this)}),r.renderMessages())},renderMessages:function(){var e=this.$el,n=e.find("> .messages");n.length===0&&(e.prepend('<div class="messages"></div>'),n=e.find("> .messages")),n.empty(),t.each(this.messages,function(e,t){n.append("<p>"+t+"</p>")})},addMessage:function(e){typeof this.messages!="array"&&(this.messages=[]),this.messages.push(e)},getSubmitButton:function(){var e=!1;return t.each(this.elements,function(t,n){n.params.type==="submit"&&(e=n.getInput())}),e},changeSubmitValue:function(e){var t=this.getSubmitButton();if(t){t.attr("data-original-value")||t.attr("data-original-value",t.attr("value"));var n="data-"+e+"-value";t.attr(n)&&t.attr("value",t.attr(n))}},destroy:function(){this.trigger("before:destroy"),this.stopListening(),this.trigger("destroy")}}),r}),define("jzform/validator/validator",["underscore"],function(e){var t={message:null,error:function(e,t){t=t||this.params;if(this.messageTemplates&&e in this.messageTemplates)var n=this.messageTemplates[e],r=this.parseMessageTemplate(n,t);else var r="Value invalid";this.message=r},parseMessageTemplate:function(e,t){return $.each(t,function(t,n){var r=new RegExp("%"+t+"%","g");e=e.replace(r,n)}),e}};return t.extend=e.extend,t}),define("jzform/validator/alnum",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){var t=new RegExp("[^a-zA-Z0-9]"),n=t.test(e);return n?(this.error("notAlnum"),!1):!0}}),t}),define("jzform/validator/between",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){return e=parseFloat(e),e<parseFloat(this.params.min)?(this.error("notBetween"),!1):e>parseFloat(this.params.max)?(this.error("notBetween"),!1):!0}}),t}),define("jzform/validator/fileExtension",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e,t){return console.log("implement file extension validator"),!0}}),t}),define("jzform/validator/fileSize",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e,t){return console.log("implement file size validator"),!0}}),t}),define("jzform/validator/float",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){var t=e===parseFloat(e);return t?(this.error("notFloat"),!1):!0}}),t}),define("jzform/validator/greaterThan",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){return e=parseFloat(e),e>parseFloat(this.params.max)?(this.error("notGreaterThan"),!1):!0}}),t}),define("jzform/validator/inArray",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){e=e.toString();var t=this.params.haystack;for(i=0;i<t.length;i++)if(e==t[i])return!0;return this.error("notInArray"),!1}}),t}),define("jzform/validator/int",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){var t=e===parseInt(e);return t?(this.error("notInt"),!1):!0}}),t}),define("jzform/validator/lessThan",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){return e=parseFloat(e),e>parseFloat(this.params.max)?(this.error("notLessThan"),!1):!0}}),t}),define("jzform/validator/matchElement",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t,this.firstValidation=!0};return e.extend(t.prototype,e,{listenForTokenChange:function(){if(this.params.element&&this.params.token){var e=this.params.element,t=this.params.token;e.listenTo(e.form,"change:"+t,e.validate)}},isValid:function(e,t){if(!t||typeof t.getValues!="function")return this.error("noContext"),!1;var n=this.params.token;if(!n)return this.error("missingToken"),!1;this.firstValidation&&(this.listenForTokenChange(),this.firstValidation=!1);var r=t.getValues();return e!==r[n]?(this.error("notSame"),!1):!0}}),t}),define("jzform/validator/notEmpty",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e,t){return!e||e.length<=0?(this.error("isEmpty"),!1):!0}}),t}),define("jzform/validator/regex",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){var t=this.params.pattern;t.substr(0,1)==="/"&&t.substr(t.length-1,1)==="/"&&(t=t.substr(1,t.length-2));var n=new RegExp(t),r=n.test(e);return r||this.error("regexNotMatch"),r}}),t}),define("jzform/validator/step",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){e=parseFloat(e);var t=this.fmod(e-this.params.baseValue,this.params.step);return t!==0&&t!==this.params.step?(this.error("notStep"),!1):!0},fmod:function(e,t){if(t==0)return 1;var n=e.substr(e.indexOf(".")+1).length+t.substr(t.indexOf(".")+1).length;return Math.round(e-t*Math.floor(e/t),n)}}),t}),define("jzform/validator/stringLength",["jzform/validator/validator"],function(e){var t=function(e,t){this.params=e,this.messageTemplates=t};return e.extend(t.prototype,e,{isValid:function(e){var t=e&&this.params.min&&e.length<this.params.min,n=e&&this.params.max&&e.length>this.params.max;return t&&this.error("stringLengthTooShort"),n&&this.error("stringLengthTooLong"),!t&&!n}}),t}),define("jzform/filter/filter",["underscore"],function(e){var t=function(e){this.params=e};return t.extend=e.extend,t}),define("jzform/filter/boolean",["jzform/filter/filter"],function(e){var t=e;return t.extend(t.prototype,{filter:function(e){switch(!0){case e===!1:case e<=0:case e==="0":case e==="":return!1;default:return!0}}}),t}),define("jzform/filter/int",["jzform/filter/filter"],function(e){var t=e;return t.extend(t.prototype,{filter:function(e){return parseInt(e)||0}}),t}),define("jzform/filter/stringToLower",["jzform/filter/filter"],function(e){var t=e;return t.extend(t.prototype,{filter:function(e){return e.toLowerCase()}}),t}),define("jzform/filter/stringToUpper",["jzform/filter/filter"],function(e){var t=e;return t.extend(t.prototype,{filter:function(e){return e.toUpperCase()}}),t}),define("jzform/filter/stringTrim",["jzform/filter/filter"],function(e){var t=e;return t.extend(t.prototype,{filter:function(e){return e.trim()}}),t});